# ReadWren Refactoring Plan

## Context

Three LLM models (Opus, Sonnet, Haiku) evaluated a reader profile generated by ReadWren and reached strong consensus on what's useful vs. noise.

### Consensus Findings

**High Value (keep/enhance):**
- `narrative_desires.wish` - the single most actionable field
- `taste_anchors` with specific books loved/hated
- `explanations` section - where the real signal lives
- `anti_patterns` - knowing what to avoid
- `themes` array - specific enough to filter against

**Low Value (remove/demote):**
- Numeric `style_signature` scores (55, 88, etc.) - "false precision", "decorative", "security theater"
- `implicit` metrics (vocabulary_richness, response_brevity, engagement_index) - measures interview, not preferences → **REMOVE ENTIRELY**
- `consumption` data - irrelevant for content matching → demote to metadata

**Keep Prominent (user decision):**
- `reader_archetype` label - kept for user "wow" factor, not model consumption. A quippy one-liner that feels prescient.

**Missing (add):**
- Reasons for dislikes (WHY they hated a book)
- Deal-breakers vs. preferences distinction
- Comparative statements ("more X than Y")
- Specific scenes/moments that resonated
- More reading history data points

---

## Files to Modify

1. `common/readwren/references/profile-schema.md` → **RENAME to `profile-template.md`** - now a Markdown template, not JSON schema
2. `common/readwren/references/profile-rubric.md` - remove numeric scoring, add qualitative guidelines
3. `common/readwren/references/profile-generation.md` - update to output Markdown, not JSON
4. `common/readwren/references/interview-methodology.md` - collect new data types (reasons, deal-breakers, comparisons)
5. `common/readwren/SKILL.md` - update main skill documentation, remove JSON references

---

## Implementation Steps

### Step 1: Restructure Profile Schema

**Remove:**
- `style_signature` numeric scores (prose_density: 55, etc.)
- `implicit` section entirely (vocabulary_richness, response_brevity, engagement_index)

**Keep Prominent:**
- `reader_archetype` as top-level field (user wants the "wow" factor)

**Restructure `taste_anchors`:**
```json
"taste_anchors": {
  "loves": [
    {
      "title": "Normal People",
      "reason": "Access to Connell's anxiety and the contrast between his public mask and inner turmoil"
    }
  ],
  "hates": [
    {
      "title": "Wicked",
      "reason": "Interesting worldbuilding but no access to character interiority"
    }
  ],
  "resonant_moments": [
    "The scene in Normal People where Connell finally admits his vulnerability"
  ],
  "inferred_genres": ["Literary fiction with psychological depth", "Enemies-to-lovers romance"]
}
```

**Add `boundaries` section:**
```json
"boundaries": {
  "deal_breakers": [
    "Characters killed without narrative meaning",
    "Slow pacing without emotional payoff"
  ],
  "strong_preferences": [
    "Hopeful or bittersweet endings (not grimdark)",
    "Access to character interiority"
  ],
  "flexible": [
    "Fantasy vs. contemporary setting",
    "Series vs. standalone"
  ]
}
```

**Add `comparisons` section:**
```json
"comparisons": [
  "More Sally Rooney than Thomas Pynchon",
  "Prefers earned catharsis over unresolved ambiguity"
]
```

**Keep but enhance:**
- `narrative_desires.wish` - unchanged, this is gold
- `themes` - unchanged
- `explanations` - expand, make first-class
- `anti_patterns` - unchanged

**Demote to metadata:**
- `consumption` - move to `_metadata`

**Flexible requirements:**
- No strict minimum for loved/hated books - collect what the user offers naturally

### Step 2: Update Profile Rubric

**Remove:**
- All 0-100 numeric scales for style dimensions
- Implicit metric scoring bands

**Replace with:**
- Qualitative calibration anchors using author/book examples
- Guidelines for writing comparative statements
- Criteria for identifying deal-breakers vs preferences
- Examples of well-formed "reasons" for loves/hates

### Step 3: Update Interview Methodology

**Remove:**
- Shadow analysis formulas for implicit metrics
- Word count tracking for scoring purposes

**Keep:**
- Engagement detection (to adapt question style)
- Coverage tracking for dimensions

**Add questions targeting:**
- "What specifically didn't work for you about [hated book]?"
- "Can you think of a specific scene or moment that stayed with you?"
- "Is [preference] a deal-breaker or just a preference?"
- "Would you say you're more of an X reader or a Y reader?"

### Step 4: Update Profile Generation Prompt

**Change output format:**
- Output Markdown using the template in `profile-template.md`
- No JSON generation

**Emphasize:**
- Reasons attached to every love/hate
- 1-2 comparative statements ("more X than Y")
- Clear separation of deal-breakers from preferences
- Ground every explanation in user's actual words
- Create a memorable, evocative reader archetype (the "wow" moment)

**Remove instructions for:**
- Calculating implicit scores
- Generating numeric style_signature
- Outputting JSON

### Step 5: Update Main SKILL.md

- Update state schema to remove implicit tracking (shadow_analysis section)
- Change output format from JSON to Markdown
- Update file path: `OUTPUT_DIR` now produces `.md` files
- Reference `profile-template.md` instead of `profile-schema.md`
- Simplify coverage dimensions
- Update key design details section

---

## New Profile Format (Markdown)

Output is now Markdown, not JSON. The qualitative prose IS the profile.

```markdown
# Reader Profile: {reader_archetype}
*Generated {date}*

## Your Ideal Story

{narrative_desires.wish - the synthesized pitch for their perfect book}

**Preferred ending:** {hopeful | bittersweet | ambiguous | tragic}

## What You Love

### {Book Title 1}
{Reason why this worked for them, grounded in their words}

### {Book Title 2}
{Reason why this worked}

**Moments that stayed with you:**
- {Specific scene or moment they mentioned}
- {Another resonant moment}

## What Doesn't Work

### {Book Title}
{Reason why this failed for them}

## Your Boundaries

**Deal-breakers** (will make you DNF):
- {Hard stop 1}
- {Hard stop 2}

**Strong preferences** (flexible but important):
- {Preference 1}
- {Preference 2}

## Your Reading Identity

{2-3 paragraph synthesis of who they are as a reader, what hooks them, what keeps them reading}

**In shorthand:** More {X} than {Y}. Prefers {A} over {B}.

## Themes You're Drawn To
- {Theme 1}
- {Theme 2}
- {Theme 3}

## What to Avoid (for recommenders)
{Anti-patterns paragraph - specific guidance on what NOT to recommend}

---
*Interview completed in {n} turns | {reading time} daily*
```

---

## Validation Criteria

A refactored profile should pass these checks:
1. Every loved/hated book has a reason explaining WHY
2. At least 1-2 comparative statements ("more X than Y")
3. Deal-breakers clearly separated from preferences
4. Reading Identity section references user's actual words
5. Anti-patterns section gives actionable guidance for recommenders
6. Reader archetype is evocative and memorable (the "wow" moment)
